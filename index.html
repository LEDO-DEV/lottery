<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dàn Đề XSMB - Nhập Kết Quả</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7fa;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 20px 0;
        }

        .container {
            margin: 20px;
        }

        .input-field {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
        }

        .input-field label {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .input-field input {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .button {
            background-color: #007BFF;
            color: white;
            font-size: 18px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .button:hover {
            background-color: #0056b3;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9f5e9;
            border-radius: 5px;
        }

        footer {
            text-align: center;
            padding: 20px;
            background-color: #333;
            color: white;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>

<header>
    <h1>Dàn Đề XSMB - Nhập Kết Quả</h1>
</header>

<div class="container">
    <div class="input-field">
        <label for="sessions">Bạn muốn nhập kết quả của bao nhiêu phiên?</label>
        <input type="number" id="sessions" min="1" required>
    </div>

    <div id="sessionInputs"></div>

    <button class="button" id="generateResults">Tính Toán Kết Quả</button>

    <div id="results" class="result" style="display:none;"></div>
</div>

<script>
    // Hàm định dạng số thành chuỗi 2 chữ số
    const formatNumber = (num) => num < 10 ? '0' + num : num.toString();

    // Hàm để lấy dữ liệu từ form
    const inputLottoData = () => {
        const sessions = parseInt(document.getElementById('sessions').value);
        const data = [];

        for (let session = 1; session <= sessions; session++) {
            const sessionData = document.getElementById('session' + session).value.trim().split('');
            const thousands = sessionData.slice(-5, -4).join(''); // Hàng chục nghìn
            const hundreds = sessionData.slice(-4, -3).join(''); // Hàng nghìn
            const tens = sessionData.slice(-3, -2).join(''); // Hàng trăm
            const lastTwoDigits = sessionData.slice(-2).join(''); // Hàng chục (2 số cuối)
            data.push({ thousands, hundreds, tens, lastTwoDigits });
        }
        return data;
    };

    // Tính toán tần suất xuất hiện của từng số
    const calculateFrequency = (data, field) => {
        const frequency = {};
        data.forEach(session => {
            const number = session[field];
            frequency[number] = (frequency[number] || 0) + 1;
        });

        return Object.entries(frequency)
            .sort((a, b) => b[1] - a[1] || a[0] - b[0]) // Sắp xếp theo tần suất giảm dần
            .map(([num, freq]) => ({ num, freq }));
    };

    // Tính toán chu kỳ (momentum)
    const calculateMomentum = (data, field) => {
        const momentum = {};
        data.forEach((session, index) => {
            const number = session[field];
            if (!momentum[number]) momentum[number] = { momentum: 0, lastIndex: index };
            else {
                momentum[number].momentum += index - momentum[number].lastIndex;
                momentum[number].lastIndex = index;
            }
        });

        return Object.entries(momentum)
            .sort((a, b) => b[1].momentum - a[1].momentum || a[0] - b[0])
            .map(([num, { momentum }]) => ({ num, momentum }));
    };

    // Tính toán các số tốt nhất
    const getBestNumbers = (frequency, momentum, topCount = 5) => {
        const combinedScores = frequency.map(({ num, freq }) => {
            const momentumScore = momentum.find(m => m.num === num)?.momentum || 0;
            return { num, score: freq + momentumScore * 2 };
        });

        return combinedScores
            .sort((a, b) => b.score - a.score || a.num - b.num)
            .slice(0, topCount);
    };

    // Hiển thị kết quả lên giao diện
    const displayResults = (data) => {
        const frequency = calculateFrequency(data, 'lastTwoDigits');
        const momentum = calculateMomentum(data, 'lastTwoDigits');
        const bestNumbers = getBestNumbers(frequency, momentum);

        let resultHtml = `
            <p><strong>Top Các Số:</strong> ${bestNumbers.map(({ num, score }) => `${num} (Điểm: ${score})`).join(', ')}</p>
        `;

        document.getElementById('results').style.display = 'block';
        document.getElementById('results').innerHTML = resultHtml;
    };

    // Tạo form nhập dữ liệu cho các phiên
    document.getElementById('sessions').addEventListener('input', () => {
        const sessions = parseInt(document.getElementById('sessions').value);
        const sessionInputs = document.getElementById('sessionInputs');
        sessionInputs.innerHTML = '';

        for (let session = 1; session <= sessions; session++) {
            const inputField = document.createElement('div');
            inputField.classList.add('input-field');
            inputField.innerHTML = `
                <label for="session${session}">Phiên ${session}: Nhập chuỗi số</label>
                <input type="text" id="session${session}" required>
            `;
            sessionInputs.appendChild(inputField);
        }
    });

    // Khi nhấn nút "Tính Toán Kết Quả"
    document.getElementById('generateResults').addEventListener('click', () => {
        const data = inputLottoData();
        displayResults(data);
    });
</script>

</body>
</html>
